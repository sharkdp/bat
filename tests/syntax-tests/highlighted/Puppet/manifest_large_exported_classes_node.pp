[3;38;2;102;217;239mclass[0m[38;2;248;248;242m [0m[38;2;166;226;46mfoo[0m[38;2;248;248;242m ($bar) [0m[38;2;248;248;242m{[0m
[38;2;248;248;242m  [0m[3;38;2;102;217;239m@@notify[0m[38;2;248;248;242m { [0m[38;2;166;226;46m'foo'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m }[0m
[38;2;248;248;242m}[0m
[3;38;2;102;217;239m@@file[0m[38;2;248;248;242m { [0m[38;2;166;226;46m"somedir/${name}_${munin_port_real}"[0m[38;2;248;248;242m:[0m
[38;2;248;248;242m  [0m[38;2;190;132;255mensure [0m[38;2;248;248;242m=> [0m[38;2;190;132;255mpresent[0m[38;2;248;248;242m,[0m
[38;2;248;248;242m  [0m[38;2;190;132;255mcontent [0m[38;2;248;248;242m=> [0m[38;2;102;217;239mtemplate[0m[38;2;248;248;242m([0m[38;2;230;219;116m"[0m[38;2;230;219;116mmunin/defaultclient.erb[0m[38;2;230;219;116m"[0m[38;2;248;248;242m),[0m
[38;2;248;248;242m}[0m
[38;2;117;113;94m#[0m[38;2;117;113;94m Collect all exported files[0m
[38;2;190;132;255mFile[0m[38;2;248;248;242m <<||>>[0m

[38;2;117;113;94m#[0m[38;2;117;113;94m Compile the munin.conf with a local header[0m
[3;38;2;102;217;239mconcatenated_file[0m[38;2;248;248;242m { [0m[38;2;166;226;46m"/etc/munin/munin.conf"[0m[38;2;248;248;242m:[0m
[38;2;248;248;242m    [0m[38;2;190;132;255mdir [0m[38;2;248;248;242m=> somedir,[0m
[38;2;248;248;242m    [0m[38;2;190;132;255mheader [0m[38;2;248;248;242m=> [0m[38;2;230;219;116m"[0m[38;2;230;219;116m/etc/munin/munin.conf.header[0m[38;2;230;219;116m"[0m[38;2;248;248;242m,[0m
[38;2;248;248;242m}[0m
[38;2;248;248;242mhosting_vserver_configuration {[0m
[38;2;248;248;242m    [0m[38;2;166;226;46m"erics":[0m
[38;2;248;248;242m        [0m[38;2;190;132;255mdomain [0m[38;2;248;248;242m=> [0m[38;2;230;219;116m"[0m[38;2;230;219;116morange.co[0m[38;2;230;219;116m"[0m[38;2;248;248;242m,[0m
[38;2;248;248;242m        [0m[38;2;190;132;255mtype [0m[38;2;248;248;242m=> [0m[38;2;230;219;116m"[0m[38;2;230;219;116mfriend[0m[38;2;230;219;116m"[0m[38;2;248;248;242m,[0m
[38;2;248;248;242m        [0m[38;2;190;132;255mcontext [0m[38;2;248;248;242m=> 13,[0m
[38;2;248;248;242m        [0m[38;2;190;132;255mip [0m[38;2;248;248;242m=> [0m[38;2;230;219;116m"[0m[38;2;230;219;116m255.255.255.254[0m[38;2;230;219;116m"[0m[38;2;248;248;242m, [0m[38;2;190;132;255mprefix [0m[38;2;248;248;242m=> 27,[0m
[38;2;248;248;242m        [0m[38;2;190;132;255madmin_user [0m[38;2;248;248;242m=> [0m[38;2;230;219;116m"[0m[38;2;230;219;116merict[0m[38;2;230;219;116m"[0m[38;2;248;248;242m, [0m[38;2;190;132;255madmin_user_name [0m[38;2;248;248;242m=> [0m[38;2;230;219;116m"[0m[38;2;230;219;116mhello, its me[0m[38;2;230;219;116m"[0m[38;2;248;248;242m,[0m
[38;2;248;248;242m        [0m[38;2;190;132;255madmin_user_email [0m[38;2;248;248;242m=> [0m[38;2;230;219;116m"[0m[38;2;230;219;116merict@orange.co[0m[38;2;230;219;116m"[0m[38;2;248;248;242m,[0m
[38;2;248;248;242m        [0m[38;2;190;132;255mcustomer [0m[38;2;248;248;242m=> [0m[38;2;230;219;116m"[0m[38;2;230;219;116mhello? is it me?[0m[38;2;230;219;116m"[0m[38;2;248;248;242m,[0m
[38;2;248;248;242m        [0m[38;2;190;132;255madmin_password [0m[38;2;248;248;242m=> [0m[38;2;190;132;255mfile[0m[38;2;248;248;242m([0m[38;2;230;219;116m"[0m[38;2;230;219;116m/etc/puppet/secrets/hosting/erict_passwd[0m[38;2;230;219;116m"[0m[38;2;248;248;242m),[0m
[38;2;248;248;242m}[0m
[3;38;2;102;217;239mclass[0m[38;2;248;248;242m [0m[38;2;166;226;46mdavids_black_co_at[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m
[38;2;248;248;242m    [0m[38;2;117;113;94m#[0m[38;2;117;113;94m# Create users for my parents and my grandmother[0m
[38;2;248;248;242m    hosting::user {[0m
[38;2;248;248;242m        [0m[38;2;166;226;46mrztt:[0m[38;2;248;248;242m [0m[38;2;190;132;255mrealname [0m[38;2;248;248;242m=> [0m[38;2;230;219;116m"[0m[38;2;230;219;116msome other rztt[0m[38;2;230;219;116m"[0m[38;2;248;248;242m,[0m
[38;2;248;248;242m            [0m[38;2;190;132;255muid [0m[38;2;248;248;242m=> 2001, [0m[38;2;190;132;255madmin [0m[38;2;248;248;242m=> [0m[38;2;190;132;255mtrue[0m[38;2;248;248;242m;[0m
[38;2;248;248;242m        [0m[38;2;166;226;46msame:[0m[38;2;248;248;242m [0m[38;2;190;132;255mrealname [0m[38;2;248;248;242m=> [0m[38;2;230;219;116m"[0m[38;2;230;219;116mcould be same[0m[38;2;230;219;116m"[0m[38;2;248;248;242m,[0m
[38;2;248;248;242m            [0m[38;2;190;132;255muid [0m[38;2;248;248;242m=> 2002;[0m
[38;2;248;248;242m        [0m[38;2;166;226;46mimapersontoodamnit:[0m[38;2;248;248;242m [0m[38;2;190;132;255mrealname [0m[38;2;248;248;242m=> [0m[38;2;230;219;116m"[0m[38;2;230;219;116msome one else[0m[38;2;230;219;116m"[0m[38;2;248;248;242m,[0m
[38;2;248;248;242m            [0m[38;2;190;132;255muid [0m[38;2;248;248;242m=> 2003;[0m
[38;2;248;248;242m    }[0m

[38;2;248;248;242m    [0m[38;2;117;113;94m#[0m[38;2;117;113;94m Install git.black.co.at[0m
[38;2;248;248;242m    [0m[38;2;249;38;114minclude[0m[38;2;248;248;242m git::daemon[0m
[38;2;248;248;242m    [0m[38;2;249;38;114minclude[0m[38;2;248;248;242m git::web[0m
[38;2;248;248;242m    git::web::export { [manifests, [0m[38;2;230;219;116m"[0m[38;2;230;219;116mpuppet-trunk[0m[38;2;230;219;116m"[0m[38;2;248;248;242m]: }[0m

[38;2;248;248;242m    [0m[38;2;117;113;94m#[0m[38;2;117;113;94m Provision an additional mysql database on the database server[0m
[38;2;248;248;242m    [0m[3;38;2;102;217;239mhosting::database[0m[38;2;248;248;242m { [0m[38;2;166;226;46m"fogbugz"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;190;132;255mtype [0m[38;2;248;248;242m=> mysql }[0m
[38;2;248;248;242m    [0m[38;2;117;113;94m#[0m[38;2;117;113;94m Create another VirtualHost[0m
[38;2;248;248;242m    [0m[3;38;2;102;217;239mapache2::site[0m[38;2;248;248;242m { [0m[38;2;166;226;46m"local-fogbugz"[0m[38;2;248;248;242m:[0m
[38;2;248;248;242m        [0m[38;2;190;132;255msource [0m[38;2;248;248;242m=> [0m[38;2;230;219;116m"[0m[38;2;230;219;116mpuppet://[0m[38;2;255;255;255m$[0m[38;2;255;255;255mservername[0m[38;2;230;219;116m/files/hosting/erict/sites/local-fogbugz[0m[38;2;230;219;116m"[0m
[38;2;248;248;242m    }[0m
[38;2;248;248;242m}[0m
[3;38;2;102;217;239mnode[0m[38;2;248;248;242m [0m[38;2;166;226;46mbackuppc[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m
[38;2;248;248;242m        [0m[38;2;117;113;94m#[0m[38;2;117;113;94m only use the smarthost[0m
[38;2;248;248;242m        [0m[38;2;255;255;255m$[0m[38;2;255;255;255mmta[0m[38;2;248;248;242m = ssmtp[0m
[38;2;248;248;242m        [0m[38;2;117;113;94m#[0m[38;2;117;113;94m this is a vserver on this host, so register correctly in nagios[0m
[38;2;248;248;242m        [0m[38;2;255;255;255m$[0m[38;2;255;255;255mnagios_parent[0m[38;2;248;248;242m = [0m[38;2;230;219;116m"[0m[38;2;230;219;116morange.co[0m[38;2;230;219;116m"[0m
[38;2;248;248;242m        [0m[38;2;117;113;94m#[0m[38;2;117;113;94m I'm sharing an IP here, so those things have to have their own ports[0m
[38;2;248;248;242m        [0m[38;2;255;255;255m$[0m[38;2;255;255;255mapache2_port[0m[38;2;248;248;242m = 8080[0m
[38;2;248;248;242m        [0m[38;2;255;255;255m$[0m[38;2;255;255;255mmunin_port[0m[38;2;248;248;242m = 5008[0m
[38;2;248;248;242m        [0m[38;2;255;255;255m$[0m[38;2;255;255;255mmunin_stats_port[0m[38;2;248;248;242m = 8667[0m

[38;2;248;248;242m        [0m[38;2;117;113;94m#[0m[38;2;117;113;94m default configuration[0m
[38;2;248;248;242m        [0m[38;2;249;38;114minclude[0m[38;2;248;248;242m dbp[0m

[38;2;248;248;242m        [0m[38;2;117;113;94m#[0m[38;2;117;113;94m configure the backuppc server[0m
[38;2;248;248;242m        [0m[38;2;249;38;114minclude[0m[38;2;248;248;242m backuppc::server[0m
[38;2;248;248;242m}[0m
